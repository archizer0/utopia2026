<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alice: Caça às Cartas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #2c3e50;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none; /* Impede scroll no telemóvel */
        }

        #gameCanvas {
            display: block;
            background: #000;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        #score-board {
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px #fff;
        }

        #start-screen, #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            color: white;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        h1 {
            font-size: 40px;
            margin-bottom: 10px;
            color: #FFD700;
            text-shadow: 2px 2px 4px #000;
        }

        p {
            font-size: 18px;
            margin-bottom: 30px;
            max-width: 80%;
            line-height: 1.5;
        }

        button {
            padding: 15px 40px;
            font-size: 24px;
            background-color: #ff4757;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s, background 0.2s;
            font-weight: bold;
        }

        button:hover {
            transform: scale(1.1);
            background-color: #ff6b81;
        }

        button:active {
            transform: scale(0.95);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div id="score-board">Pontos: <span id="score-val">0</span></div>
    </div>

    <div id="start-screen">
        <h1>Alice no País das Maravilhas</h1>
        <p>Ajuda a Alice a apanhar as <b>Cartas de Copas</b>!<br>Evita os <b>Soldados de Espadas</b>.</p>
        <p style="font-size: 14px; color: #ddd;">(Usa o rato ou o dedo para mover a Alice)</p>
        <button id="start-btn">JOGAR</button>
    </div>

    <div id="game-over-screen" class="hidden">
        <h1>Fim do Jogo!</h1>
        <p>A Rainha apanhou-te!</p>
        <p>Pontuação Final: <span id="final-score">0</span></p>
        <button id="restart-btn">TENTAR DE NOVO</button>
    </div>

    <script>
        // Configuração do Canvas
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
       
        let width, height;
       
        // Estado do Jogo
        let gameRunning = false;
        let score = 0;
        let animationId;
        let difficultyMultiplier = 1;

        // Elementos UI
        const scoreEl = document.getElementById('score-val');
        const finalScoreEl = document.getElementById('final-score');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        // Objetos do Jogo
        const player = {
            x: 0,
            y: 0,
            radius: 25,
            color: '#3498db',
            targetX: 0,
            targetY: 0
        };

        let cards = [];
        let particles = [];

        // Redimensionar
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
           
            // Posição inicial do jogador (centro baixo)
            if (!gameRunning) {
                player.x = width / 2;
                player.y = height - 100;
                player.targetX = width / 2;
                player.targetY = height - 100;
            }
        }
        window.addEventListener('resize', resize);
        resize();

        // --- Controlo de Input (Rato e Toque) ---
        function updateInput(x, y) {
            player.targetX = x;
            player.targetY = y;
        }

        window.addEventListener('mousemove', (e) => {
            if (gameRunning) updateInput(e.clientX, e.clientY);
        });

        window.addEventListener('touchmove', (e) => {
            if (gameRunning) {
                e.preventDefault(); // Impede scroll
                updateInput(e.touches[0].clientX, e.touches[0].clientY);
            }
        }, { passive: false });

        window.addEventListener('touchstart', (e) => {
            if (gameRunning) {
                updateInput(e.touches[0].clientX, e.touches[0].clientY);
            }
        }, { passive: false });

        // --- Lógica do Jogo ---

        class Card {
            constructor() {
                this.width = 30;
                this.height = 45;
                this.x = Math.random() * (width - this.width);
                this.y = -50;
                // 70% hipótese de ser bom (Copas), 30% mau (Espadas/Soldado)
                this.isEnemy = Math.random() > 0.7;
                this.speed = (Math.random() * 2 + 3) * difficultyMultiplier;
                this.rotation = Math.random() * Math.PI;
                this.rotSpeed = (Math.random() - 0.5) * 0.1;
            }

            update() {
                this.y += this.speed;
                this.rotation += this.rotSpeed;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x + this.width/2, this.y + this.height/2);
                ctx.rotate(this.rotation);
               
                // Efeito de Brilho nas Cartas
                ctx.shadowBlur = 20;
                ctx.shadowColor = this.isEnemy ? '#aaa' : '#ff0000';

                // Desenhar a carta (fundo branco)
                ctx.fillStyle = '#fff';
                ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
               
                // Desenhar o naipe
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
               
                if (this.isEnemy) {
                    // Carta de Espadas (Inimigo)
                    ctx.fillStyle = '#000';
                    ctx.fillText('♠', 0, 0);
                    // Borda preta
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(-this.width/2, -this.height/2, this.width, this.height);
                } else {
                    // Carta de Copas (Ponto)
                    ctx.fillStyle = '#e74c3c';
                    ctx.fillText('♥', 0, 0);
                }

                ctx.restore();
            }
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 5;
                this.vy = (Math.random() - 0.5) * 5;
                this.alpha = 1;
                this.color = color;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= 0.02;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
               
                // Partículas brilhantes
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;

                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        function createParticles(x, y, color) {
            for (let i = 0; i < 10; i++) {
                particles.push(new Particle(x, y, color));
            }
        }

        // Desenhar a Alice
        function drawPlayer() {
            // Suavizar movimento (Lerp)
            player.x += (player.targetX - player.x) * 0.15;
            player.y += (player.targetY - player.y) * 0.15;

            ctx.save();
            ctx.translate(player.x, player.y);

            // Efeito de Brilho na Alice
            ctx.shadowBlur = 25;
            ctx.shadowColor = '#3498db';

            // Cabelo (Loira)
            ctx.fillStyle = '#f1c40f';
            ctx.beginPath();
            ctx.arc(0, -10, 22, 0, Math.PI * 2);
            ctx.fill();

            // Vestido (Azul Alice)
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.moveTo(0, -5);
            ctx.lineTo(-20, 30);
            ctx.lineTo(20, 30);
            ctx.fill();

            // Avental (Branco)
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(-10, 30);
            ctx.lineTo(10, 30);
            ctx.fill();

            // Rosto
            ctx.fillStyle = '#ffeaa7';
            ctx.beginPath();
            ctx.arc(0, -10, 12, 0, Math.PI * 2);
            ctx.fill();

            // Laço Preto
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.fillRect(-12, -22, 24, 4);

            ctx.restore();
        }

        // Fundo removido (apenas limpa para manter o preto do CSS)
        function drawBackground() {
            // Nenhuma ação necessária, o fundo CSS é preto
        }

        function gameLoop() {
            if (!gameRunning) return;

            // Limpar
            ctx.clearRect(0, 0, width, height);

            drawBackground();

            // Gerar Cartas
            if (Math.random() < 0.03 + (score * 0.001)) { // Aumenta frequência com o tempo
                cards.push(new Card());
            }

            // Atualizar e Desenhar Cartas
            for (let i = cards.length - 1; i >= 0; i--) {
                const c = cards[i];
                c.update();
                c.draw();

                // Colisão simples (distância)
                const dx = player.x - (c.x + c.width/2);
                const dy = player.y - (c.y + c.height/2);
                const dist = Math.sqrt(dx*dx + dy*dy);

                if (dist < player.radius + 15) {
                    if (c.isEnemy) {
                        // Game Over
                        createParticles(player.x, player.y, '#000');
                        endGame();
                        return;
                    } else {
                        // Pontuar
                        score++;
                        scoreEl.innerText = score;
                        createParticles(c.x + c.width/2, c.y + c.height/2, '#e74c3c');
                        cards.splice(i, 1);
                       
                        // Aumentar dificuldade ligeiramente
                        if (score % 5 === 0) difficultyMultiplier += 0.1;
                    }
                }

                // Remover cartas fora do ecrã
                if (c.y > height) {
                    cards.splice(i, 1);
                }
            }

            // Atualizar e Desenhar Partículas
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].alpha <= 0) particles.splice(i, 1);
            }

            drawPlayer();

            animationId = requestAnimationFrame(gameLoop);
        }

        function startGame() {
            score = 0;
            difficultyMultiplier = 1;
            cards = [];
            particles = [];
            scoreEl.innerText = '0';
           
            // Reset player pos para evitar colisão imediata
            player.x = width / 2;
            player.y = height - 100;
            player.targetX = width / 2;
            player.targetY = height - 100;

            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            gameRunning = true;
            gameLoop();
        }

        function endGame() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            finalScoreEl.innerText = score;
            gameOverScreen.classList.remove('hidden');
        }

        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', startGame);

    </script>
</body>
</html>