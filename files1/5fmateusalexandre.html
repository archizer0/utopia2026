<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alice no Pa√≠s das Maravilhas: A Fuga do Ch√°</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lato:wght@400;700&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #2c3e50;
            font-family: 'Lato', sans-serif;
            touch-action: none; /* Impede zoom e scroll no mobile */
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle, #a8e6cf 0%, #dcedc1 100%);
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        /* Interface do Usu√°rio (UI) */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        #score-board {
            padding: 20px;
            font-family: 'Cinzel', serif;
            font-size: 24px;
            color: #c0392b;
            text-shadow: 2px 2px 0px #fff;
            pointer-events: none;
        }

        /* Telas de Menu e Game Over */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            transition: opacity 0.3s;
            z-index: 10;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        h1 {
            font-family: 'Cinzel', serif;
            color: #c0392b; /* Vermelho Rainha */
            font-size: 3rem;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        p {
            font-size: 1.2rem;
            color: #333;
            text-align: center;
            max-width: 600px;
            margin: 10px 20px;
        }

        button {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-family: 'Cinzel', serif;
            color: white;
            background-color: #c0392b;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(192, 57, 43, 0.4);
            transition: transform 0.2s, background-color 0.2s;
            animation: pulse 2s infinite;
        }

        button:hover {
            background-color: #e74c3c;
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        .instructions {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #c0392b;
            margin-top: 20px;
        }

        .key-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 1.1rem;
        }
        .icon { font-size: 1.5rem; margin-right: 10px; width: 30px; text-align: center;}

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(192, 57, 43, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(192, 57, 43, 0); }
            100% { box-shadow: 0 0 0 0 rgba(192, 57, 43, 0); }
        }

        /* Efeito de Dano */
        #damage-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 50%, red 100%);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 5;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="damage-overlay"></div>
   
    <div id="ui-layer">
        <div id="score-board">Pontos: <span id="score">0</span></div>
    </div>

    <!-- Tela Inicial -->
    <div id="start-screen" class="screen">
        <h1>Alice no Pa√≠s das Maravilhas</h1>
        <p>Ajude Alice a coletar ch√°s e bolos antes que a Rainha de Copas a pegue!</p>
       
        <div class="instructions">
            <div class="key-item"><span class="icon">‚å®Ô∏è</span> Use as <strong>SETAS</strong> para mover a Alice</div>
            <div class="key-item"><span class="icon">‚òï</span> Pegue Ch√° (+10 pts)</div>
            <div class="key-item"><span class="icon">üç∞</span> Pegue Bolo (+50 pts + Invencibilidade)</div>
            <div class="key-item"><span class="icon">üÉè</span> Evite as Cartas!</div>
        </div>

        <button onclick="startGame()">Jogar</button>
    </div>

    <!-- Tela de Game Over -->
    <div id="game-over-screen" class="screen hidden">
        <h1>Cortem as Cabe√ßas!</h1>
        <p>Voc√™ foi pego pelas cartas.</p>
        <p>Pontua√ß√£o Final: <strong id="final-score" style="font-size: 1.5rem; color: #c0392b;">0</strong></p>
        <button onclick="resetGame()">Tentar Novamente</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const finalScoreEl = document.getElementById('final-score');
    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over-screen');
    const damageOverlay = document.getElementById('damage-overlay');

    // Configura√ß√£o do Jogo
    let gameRunning = false;
    let score = 0;
    let frameCount = 0;
    let difficultyMultiplier = 1;

    // Redimensionamento
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // CONTROLO POR TECLADO
    const keys = {
        ArrowUp: false,
        ArrowDown: false,
        ArrowLeft: false,
        ArrowRight: false,
        w: false,
        a: false,
        s: false,
        d: false
    };

    window.addEventListener('keydown', (e) => {
        if (keys.hasOwnProperty(e.key) || keys.hasOwnProperty(e.key.toLowerCase())) {
            keys[e.key] = true;
        }
    });

    window.addEventListener('keyup', (e) => {
        if (keys.hasOwnProperty(e.key) || keys.hasOwnProperty(e.key.toLowerCase())) {
            keys[e.key] = false;
        }
    });

    // Objeto Alice
    const alice = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        radius: 20, // Tamanho padr√£o pequeno
        baseRadius: 20,
        color: '#3498db', // Azul do vestido
        moveSpeed: 7, // Velocidade de movimento com teclas
        invincible: false,
        invincibleTimer: 0,
        shrunk: false,
        shrinkTimer: 0,
       
        draw: function() {
            // Sombra
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(this.x, this.y + this.radius, this.radius, this.radius * 0.3, 0, 0, Math.PI * 2);
            ctx.fill();

            // Efeito de Invencibilidade (Piscando)
            if (this.invincible && Math.floor(Date.now() / 100) % 2 === 0) {
                ctx.globalAlpha = 0.5;
            }

            // Desenhar Alice (Emoji ou Formas Simples)
            ctx.font = `${this.radius * 2.5}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            // Se estiver pequena, usa emoji de beb√™ ou menina, se normal usa princesa/menina
            ctx.fillText(this.shrunk ? 'üë∂' : 'üë±‚Äç‚ôÄÔ∏è', this.x, this.y);
           
            ctx.globalAlpha = 1.0;

            // Barra de efeito (se houver)
            if (this.invincible) {
                ctx.strokeStyle = '#f1c40f';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius + 5, 0, Math.PI * 2);
                ctx.stroke();
            }
        },
       
        update: function() {
            // Movimento pelas SETAS ou WASD
            if (keys.ArrowUp || keys.w || keys.W) this.y -= this.moveSpeed;
            if (keys.ArrowDown || keys.s || keys.S) this.y += this.moveSpeed;
            if (keys.ArrowLeft || keys.a || keys.A) this.x -= this.moveSpeed;
            if (keys.ArrowRight || keys.d || keys.D) this.x += this.moveSpeed;

            // Limites da tela
            if (this.x < this.radius) this.x = this.radius;
            if (this.x > canvas.width - this.radius) this.x = canvas.width - this.radius;
            if (this.y < this.radius) this.y = this.radius;
            if (this.y > canvas.height - this.radius) this.y = canvas.height - this.radius;

            // Timer de Invencibilidade (Bolo)
            if (this.invincible) {
                this.invincibleTimer--;
                if (this.invincibleTimer <= 0) this.invincible = false;
            }

            // Timer de Encolhimento (Po√ß√£o)
            if (this.shrunk) {
                this.shrinkTimer--;
                if (this.shrinkTimer <= 0) {
                    this.shrunk = false;
                    this.radius = this.baseRadius; // Volta ao normal
                }
            }
        }
    };

    // Colecion√°veis e Inimigos
    let items = [];
    let enemies = [];
    let particles = [];

    class Item {
        constructor() {
            this.x = Math.random() * (canvas.width - 40) + 20;
            this.y = -50;
            this.speed = Math.random() * 2 + 2;
            this.type = Math.random();
            // 0-0.8: Ch√°, 0.8-1.0: Bolo (Po√ß√£o removida)
           
            if (this.type < 0.8) {
                this.symbol = '‚òï';
                this.val = 'tea';
            } else {
                this.symbol = 'üç∞';
                this.val = 'cake';
            }
            this.radius = 20;
            this.angle = 0;
        }

        update() {
            this.y += this.speed;
            this.angle += 0.02;
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(Math.sin(this.angle) * 0.2);
            ctx.font = "30px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(this.symbol, 0, 0);
            ctx.restore();
        }
    }

    class Enemy {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = -60;
            // Velocidade reduzida
            this.speed = (Math.random() * 2 + 1.5) * difficultyMultiplier;
            this.width = 40;
            this.height = 60;
            this.suit = Math.random() > 0.5 ? '‚ô•Ô∏è' : '‚ô†Ô∏è'; // Rainha de Copas ou Espadas
            this.color = this.suit === '‚ô•Ô∏è' ? '#c0392b' : '#2c3e50';
        }

        update() {
            this.y += this.speed;
        }

        draw() {
            // Desenhar Carta
            ctx.fillStyle = '#ecf0f1';
            ctx.fillRect(this.x - this.width/2, this.y - this.height/2, this.width, this.height);
           
            ctx.strokeStyle = '#7f8c8d';
            ctx.lineWidth = 1;
            ctx.strokeRect(this.x - this.width/2, this.y - this.height/2, this.width, this.height);

            ctx.font = "24px Arial";
            ctx.fillStyle = this.color;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(this.suit, this.x, this.y);
        }
    }

    // Part√≠culas para efeitos
    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.size = Math.random() * 5 + 2;
            this.speedX = Math.random() * 4 - 2;
            this.speedY = Math.random() * 4 - 2;
            this.color = color;
            this.life = 60;
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            this.life--;
            this.size *= 0.95;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    function createParticles(x, y, color) {
        for(let i=0; i<10; i++) {
            particles.push(new Particle(x, y, color));
        }
    }

    // Input Handling
    // Removido o evento 'mousemove' que causava erro pois 'mouse' n√£o estava definido
   
    // Mantemos apenas a preven√ß√£o de scroll no mobile, sem l√≥gica de jogo
    window.addEventListener('touchmove', (e) => {
        e.preventDefault();
    }, { passive: false });

    // L√≥gica do Jogo
    function spawnEntities() {
        // Spawn Items
        if (frameCount % 60 === 0) {
            items.push(new Item());
        }

        // Spawn Enemies (Frequ√™ncia aumenta com dificuldade)
        let spawnRate = Math.max(20, 60 - Math.floor(score / 50));
        if (frameCount % spawnRate === 0) {
            enemies.push(new Enemy());
        }
    }

    function checkCollisions() {
        // Alice vs Items
        for (let i = items.length - 1; i >= 0; i--) {
            const item = items[i];
            const dist = Math.hypot(alice.x - item.x, alice.y - item.y);

            if (dist < alice.radius + item.radius) {
                // Coletou item
                if (item.val === 'tea') {
                    score += 10;
                    createParticles(item.x, item.y, '#e67e22');
                } else if (item.val === 'cake') {
                    score += 50;
                    alice.invincible = true;
                    alice.invincibleTimer = 300; // 5 segundos
                    createParticles(item.x, item.y, '#f1c40f');
                }
                items.splice(i, 1);
            } else if (item.y > canvas.height + 50) {
                items.splice(i, 1);
            }
        }

        // Alice vs Enemies
        for (let i = enemies.length - 1; i >= 0; i--) {
            const enemy = enemies[i];
            // Caixa de colis√£o retangular simples para a carta
            const distX = Math.abs(alice.x - enemy.x);
            const distY = Math.abs(alice.y - enemy.y);

            if (distX < (enemy.width/2 + alice.radius * 0.7) && distY < (enemy.height/2 + alice.radius * 0.7)) {
                if (alice.invincible) {
                    // Destruir inimigo se invenc√≠vel
                    enemies.splice(i, 1);
                    score += 5;
                    createParticles(enemy.x, enemy.y, '#c0392b');
                } else {
                    // Game Over
                    gameOver();
                }
            } else if (enemy.y > canvas.height + 50) {
                enemies.splice(i, 1);
            }
        }
    }

    function drawBackground() {
        // Efeito de tabuleiro de xadrez sutil
        const size = 100;
        ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
        for(let x = 0; x < canvas.width; x += size) {
            for(let y = 0; y < canvas.height; y += size) {
                if ((x/size + y/size) % 2 === 0) {
                    ctx.fillRect(x, y, size, size);
                }
            }
        }
    }

    function update() {
        if (!gameRunning) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
       
        drawBackground();

        alice.update();
        alice.draw();

        items.forEach(item => { item.update(); item.draw(); });
        enemies.forEach(enemy => { enemy.update(); enemy.draw(); });
       
        particles.forEach((p, index) => {
            p.update();
            p.draw();
            if(p.life <= 0) particles.splice(index, 1);
        });

        spawnEntities();
        checkCollisions();

        // UI Update
        scoreEl.innerText = score;
       
        // Dificuldade progressiva
        difficultyMultiplier = 1 + (score / 500);

        frameCount++;
        requestAnimationFrame(update);
    }

    function startGame() {
        startScreen.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
       
        // Reset state
        score = 0;
        frameCount = 0;
        items = [];
        enemies = [];
        particles = [];
        alice.x = canvas.width / 2;
        alice.y = canvas.height / 2;
        alice.invincible = false;
        alice.shrunk = false;
        alice.radius = alice.baseRadius;
       
        gameRunning = true;
       
        // Reset Keys
        Object.keys(keys).forEach(k => keys[k] = false);

        requestAnimationFrame(update);
    }

    function gameOver() {
        gameRunning = false;
        finalScoreEl.innerText = score;
       
        // Efeito de tela vermelha
        damageOverlay.style.opacity = '0.5';
        setTimeout(() => {
            damageOverlay.style.opacity = '0';
            gameOverScreen.classList.remove('hidden');
        }, 500);
    }

    function resetGame() {
        startGame();
    }

</script>
</body>
</html>
